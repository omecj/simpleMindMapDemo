{"ast":null,"code":"import btnsSvg from '../../../svg/btns';\nimport { SVG, Circle, G } from '@svgdotjs/svg.js';\n\n// 创建展开收起按钮的内容节点\nfunction createExpandNodeContent() {\n  if (this._openExpandNode) {\n    return;\n  }\n  let {\n    close,\n    open\n  } = this.mindMap.opt.expandBtnIcon || {};\n  // 根据配置判断是否显示数量按钮\n  if (this.mindMap.opt.isShowExpandNum) {\n    // 展开的节点\n    this._openExpandNode = SVG().text().size(this.expandBtnSize, this.expandBtnSize);\n    // 文本垂直居中\n    this._openExpandNode.attr({\n      'text-anchor': 'middle',\n      'dominant-baseline': 'middle',\n      x: this.expandBtnSize / 2,\n      y: 2\n    });\n  } else {\n    this._openExpandNode = SVG(open || btnsSvg.open).size(this.expandBtnSize, this.expandBtnSize);\n    this._openExpandNode.x(0).y(-this.expandBtnSize / 2);\n  }\n  // 收起的节点\n  this._closeExpandNode = SVG(close || btnsSvg.close).size(this.expandBtnSize, this.expandBtnSize);\n  this._closeExpandNode.x(0).y(-this.expandBtnSize / 2);\n  // 填充节点\n  this._fillExpandNode = new Circle().size(this.expandBtnSize);\n  this._fillExpandNode.x(0).y(-this.expandBtnSize / 2);\n\n  // 设置样式\n  this.style.iconBtn(this._openExpandNode, this._closeExpandNode, this._fillExpandNode);\n}\nfunction sumNode(data = []) {\n  return data.reduce((total, cur) => total + this.sumNode(cur.children || []), data.length);\n}\n//  创建或更新展开收缩按钮内容\nfunction updateExpandBtnNode() {\n  let {\n    expand\n  } = this.getData();\n  // 如果本次和上次的展开状态一样则返回\n  if (expand === this._lastExpandBtnType) return;\n  if (this._expandBtn) {\n    this._expandBtn.clear();\n  }\n  this.createExpandNodeContent();\n  let node;\n  if (expand === false) {\n    node = this._openExpandNode;\n    this._lastExpandBtnType = false;\n  } else {\n    node = this._closeExpandNode;\n    this._lastExpandBtnType = true;\n  }\n  if (this._expandBtn) {\n    // 如果是收起按钮加上边框\n    let {\n      isShowExpandNum,\n      expandBtnStyle,\n      expandBtnNumHandler\n    } = this.mindMap.opt;\n    if (isShowExpandNum) {\n      if (!expand) {\n        // 数字按钮添加边框\n        this._fillExpandNode.stroke({\n          color: expandBtnStyle.strokeColor\n        });\n        // 计算子节点数量\n        let count = this.sumNode(this.nodeData.children);\n        count = expandBtnNumHandler(count);\n        node.text(count);\n      } else {\n        this._fillExpandNode.stroke('none');\n      }\n    }\n    this._expandBtn.add(this._fillExpandNode).add(node);\n  }\n}\n\n//  更新展开收缩按钮位置\nfunction updateExpandBtnPos() {\n  if (!this._expandBtn) {\n    return;\n  }\n  this.renderer.layout.renderExpandBtn(this, this._expandBtn);\n}\n\n//  创建展开收缩按钮\nfunction renderExpandBtn() {\n  if (!this.nodeData.children || this.nodeData.children.length <= 0 || this.isRoot) {\n    return;\n  }\n  if (this._expandBtn) {\n    this.group.add(this._expandBtn);\n  } else {\n    this._expandBtn = new G();\n    this._expandBtn.on('mouseover', e => {\n      e.stopPropagation();\n      this._expandBtn.css({\n        cursor: 'pointer'\n      });\n    });\n    this._expandBtn.on('mouseout', e => {\n      e.stopPropagation();\n      this._expandBtn.css({\n        cursor: 'auto'\n      });\n    });\n    this._expandBtn.on('click', e => {\n      e.stopPropagation();\n      // 展开收缩\n      this.mindMap.execCommand('SET_NODE_EXPAND', this, !this.getData('expand'));\n      this.mindMap.emit('expand_btn_click', this);\n    });\n    this._expandBtn.on('dblclick', e => {\n      e.stopPropagation();\n    });\n    this._expandBtn.addClass('smm-expand-btn');\n    this.group.add(this._expandBtn);\n  }\n  this._showExpandBtn = true;\n  this.updateExpandBtnNode();\n  this.updateExpandBtnPos();\n}\n\n//  移除展开收缩按钮\nfunction removeExpandBtn() {\n  if (this._expandBtn && this._showExpandBtn) {\n    this._expandBtn.remove();\n    this._showExpandBtn = false;\n  }\n}\n\n// 显示展开收起按钮\nfunction showExpandBtn() {\n  if (this.mindMap.opt.alwaysShowExpandBtn) return;\n  setTimeout(() => {\n    this.renderExpandBtn();\n  }, 0);\n}\n\n// 隐藏展开收起按钮\nfunction hideExpandBtn() {\n  if (this.mindMap.opt.alwaysShowExpandBtn || this._isMouseenter) return;\n  // 非激活状态且展开状态鼠标移出才隐藏按钮\n  let {\n    isActive,\n    expand\n  } = this.getData();\n  if (!isActive && expand) {\n    setTimeout(() => {\n      this.removeExpandBtn();\n    }, 0);\n  }\n}\nexport default {\n  createExpandNodeContent,\n  updateExpandBtnNode,\n  updateExpandBtnPos,\n  renderExpandBtn,\n  removeExpandBtn,\n  showExpandBtn,\n  hideExpandBtn,\n  sumNode\n};","map":{"version":3,"names":["btnsSvg","SVG","Circle","G","createExpandNodeContent","_openExpandNode","close","open","mindMap","opt","expandBtnIcon","isShowExpandNum","text","size","expandBtnSize","attr","x","y","_closeExpandNode","_fillExpandNode","style","iconBtn","sumNode","data","reduce","total","cur","children","length","updateExpandBtnNode","expand","getData","_lastExpandBtnType","_expandBtn","clear","node","expandBtnStyle","expandBtnNumHandler","stroke","color","strokeColor","count","nodeData","add","updateExpandBtnPos","renderer","layout","renderExpandBtn","isRoot","group","on","e","stopPropagation","css","cursor","execCommand","emit","addClass","_showExpandBtn","removeExpandBtn","remove","showExpandBtn","alwaysShowExpandBtn","setTimeout","hideExpandBtn","_isMouseenter","isActive"],"sources":["C:/Users/otff/Desktop/mindmap_demo/mind_demo/node_modules/simple-mind-map/src/core/render/node/nodeExpandBtn.js"],"sourcesContent":["import btnsSvg from '../../../svg/btns'\r\nimport { SVG, Circle, G } from '@svgdotjs/svg.js'\r\n\r\n// 创建展开收起按钮的内容节点\r\nfunction createExpandNodeContent() {\r\n  if (this._openExpandNode) {\r\n    return\r\n  }\r\n  let { close, open } = this.mindMap.opt.expandBtnIcon || {}\r\n  // 根据配置判断是否显示数量按钮\r\n  if (this.mindMap.opt.isShowExpandNum) {\r\n    // 展开的节点\r\n    this._openExpandNode = SVG()\r\n      .text()\r\n      .size(this.expandBtnSize, this.expandBtnSize)\r\n    // 文本垂直居中\r\n    this._openExpandNode.attr({\r\n      'text-anchor': 'middle',\r\n      'dominant-baseline': 'middle',\r\n      x: this.expandBtnSize / 2,\r\n      y: 2\r\n    })\r\n  } else {\r\n    this._openExpandNode = SVG(open || btnsSvg.open).size(\r\n      this.expandBtnSize,\r\n      this.expandBtnSize\r\n    )\r\n    this._openExpandNode.x(0).y(-this.expandBtnSize / 2)\r\n  }\r\n  // 收起的节点\r\n  this._closeExpandNode = SVG(close || btnsSvg.close).size(\r\n    this.expandBtnSize,\r\n    this.expandBtnSize\r\n  )\r\n  this._closeExpandNode.x(0).y(-this.expandBtnSize / 2)\r\n  // 填充节点\r\n  this._fillExpandNode = new Circle().size(this.expandBtnSize)\r\n  this._fillExpandNode.x(0).y(-this.expandBtnSize / 2)\r\n\r\n  // 设置样式\r\n  this.style.iconBtn(\r\n    this._openExpandNode,\r\n    this._closeExpandNode,\r\n    this._fillExpandNode\r\n  )\r\n}\r\nfunction sumNode(data = []) {\r\n  return data.reduce(\r\n    (total, cur) => total + this.sumNode(cur.children || []),\r\n    data.length\r\n  )\r\n}\r\n//  创建或更新展开收缩按钮内容\r\nfunction updateExpandBtnNode() {\r\n  let { expand } = this.getData()\r\n  // 如果本次和上次的展开状态一样则返回\r\n  if (expand === this._lastExpandBtnType) return\r\n  if (this._expandBtn) {\r\n    this._expandBtn.clear()\r\n  }\r\n  this.createExpandNodeContent()\r\n  let node\r\n  if (expand === false) {\r\n    node = this._openExpandNode\r\n    this._lastExpandBtnType = false\r\n  } else {\r\n    node = this._closeExpandNode\r\n    this._lastExpandBtnType = true\r\n  }\r\n\r\n  if (this._expandBtn) {\r\n    // 如果是收起按钮加上边框\r\n    let { isShowExpandNum, expandBtnStyle, expandBtnNumHandler } =\r\n      this.mindMap.opt\r\n    if (isShowExpandNum) {\r\n      if (!expand) {\r\n        // 数字按钮添加边框\r\n        this._fillExpandNode.stroke({\r\n          color: expandBtnStyle.strokeColor\r\n        })\r\n        // 计算子节点数量\r\n        let count = this.sumNode(this.nodeData.children)\r\n        count = expandBtnNumHandler(count)\r\n        node.text(count)\r\n      } else {\r\n        this._fillExpandNode.stroke('none')\r\n      }\r\n    }\r\n    this._expandBtn.add(this._fillExpandNode).add(node)\r\n  }\r\n}\r\n\r\n//  更新展开收缩按钮位置\r\nfunction updateExpandBtnPos() {\r\n  if (!this._expandBtn) {\r\n    return\r\n  }\r\n  this.renderer.layout.renderExpandBtn(this, this._expandBtn)\r\n}\r\n\r\n//  创建展开收缩按钮\r\nfunction renderExpandBtn() {\r\n  if (\r\n    !this.nodeData.children ||\r\n    this.nodeData.children.length <= 0 ||\r\n    this.isRoot\r\n  ) {\r\n    return\r\n  }\r\n  if (this._expandBtn) {\r\n    this.group.add(this._expandBtn)\r\n  } else {\r\n    this._expandBtn = new G()\r\n    this._expandBtn.on('mouseover', e => {\r\n      e.stopPropagation()\r\n      this._expandBtn.css({\r\n        cursor: 'pointer'\r\n      })\r\n    })\r\n    this._expandBtn.on('mouseout', e => {\r\n      e.stopPropagation()\r\n      this._expandBtn.css({\r\n        cursor: 'auto'\r\n      })\r\n    })\r\n    this._expandBtn.on('click', e => {\r\n      e.stopPropagation()\r\n      // 展开收缩\r\n      this.mindMap.execCommand(\r\n        'SET_NODE_EXPAND',\r\n        this,\r\n        !this.getData('expand')\r\n      )\r\n      this.mindMap.emit('expand_btn_click', this)\r\n    })\r\n    this._expandBtn.on('dblclick', e => {\r\n      e.stopPropagation()\r\n    })\r\n    this._expandBtn.addClass('smm-expand-btn')\r\n    this.group.add(this._expandBtn)\r\n  }\r\n  this._showExpandBtn = true\r\n  this.updateExpandBtnNode()\r\n  this.updateExpandBtnPos()\r\n}\r\n\r\n//  移除展开收缩按钮\r\nfunction removeExpandBtn() {\r\n  if (this._expandBtn && this._showExpandBtn) {\r\n    this._expandBtn.remove()\r\n    this._showExpandBtn = false\r\n  }\r\n}\r\n\r\n// 显示展开收起按钮\r\nfunction showExpandBtn() {\r\n  if (this.mindMap.opt.alwaysShowExpandBtn) return\r\n  setTimeout(() => {\r\n    this.renderExpandBtn()\r\n  }, 0)\r\n}\r\n\r\n// 隐藏展开收起按钮\r\nfunction hideExpandBtn() {\r\n  if (this.mindMap.opt.alwaysShowExpandBtn || this._isMouseenter) return\r\n  // 非激活状态且展开状态鼠标移出才隐藏按钮\r\n  let { isActive, expand } = this.getData()\r\n  if (!isActive && expand) {\r\n    setTimeout(() => {\r\n      this.removeExpandBtn()\r\n    }, 0)\r\n  }\r\n}\r\n\r\nexport default {\r\n  createExpandNodeContent,\r\n  updateExpandBtnNode,\r\n  updateExpandBtnPos,\r\n  renderExpandBtn,\r\n  removeExpandBtn,\r\n  showExpandBtn,\r\n  hideExpandBtn,\r\n  sumNode\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}